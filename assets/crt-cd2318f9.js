function p(c,e){return c=Math.ceil(c),e=Math.floor(e),Math.floor(Math.random()*(e-c+1))+c}class u{constructor(e,t){this.parent=e,typeof e=="string"&&(this.parent=document.querySelector(e)),this.config=Object.assign({},{},t),this.effects={},this.events={resize:this.onResize.bind(this)},window.addEventListener("resize",this.events.resize,!1),this.render()}render(){const e=document.createElement("div");e.classList.add("screen-container");const t=document.createElement("div");t.classList.add("screen-wrapper");const a=document.createElement("div");a.classList.add("screen-wrapper");const s=document.createElement("div");s.classList.add("screen-wrapper"),t.appendChild(a),a.appendChild(s),e.appendChild(t),this.parent.parentNode.insertBefore(e,this.parent),s.appendChild(this.parent),this.nodes={container:e,wrapper1:t,wrapper2:a,wrapper3:s},this.onResize()}onResize(e){this.rect=this.parent.getBoundingClientRect(),this.effects.vcr&&this.effects.vcr.enabled&&this.generateVCRNoise()}add(e,t){const a=Object.assign({},{fps:30,blur:1},t);if(Array.isArray(e)){for(const i of e)this.add(i);return this}const s=this;if(e==="snow"){let h=function(){s.generateSnow(l),s.snowframe=requestAnimationFrame(h)};var o=h;const i=document.createElement("canvas"),l=i.getContext("2d");return i.classList.add(e),i.width=this.rect.width/2,i.height=this.rect.height/2,this.nodes.wrapper2.appendChild(i),h(),this.effects[e]={wrapper:this.nodes.wrapper2,node:i,enabled:!0,config:a},this}if(e==="roll")return this.enableRoll();if(e==="vcr"){const i=document.createElement("canvas");return i.classList.add(e),this.nodes.wrapper2.appendChild(i),i.width=this.rect.width,i.height=this.rect.height,this.effects[e]={wrapper:this.nodes.wrapper2,node:i,ctx:i.getContext("2d"),enabled:!0,config:a},this.generateVCRNoise(),this}let n=!1,r=this.nodes.wrapper2;switch(e){case"wobblex":case"wobbley":r.classList.add(e);break;case"scanlines":n=document.createElement("div"),n.classList.add(e),r.appendChild(n);break;case"vignette":r=this.nodes.container,n=document.createElement("div"),n.classList.add(e),r.appendChild(n);break;case"image":r=this.parent,n=document.createElement("img"),n.classList.add(e),n.src=a.src,r.appendChild(n);break;case"video":r=this.parent,n=document.createElement("video"),n.classList.add(e),n.src=a.src,n.crossOrigin="anonymous",n.autoplay=!0,n.muted=!0,n.loop=!0,r.appendChild(n);break}return this.effects[e]={wrapper:r,node:n,enabled:!0,config:a},this}remove(e){const t=this.effects[e];return e in this.effects&&t.enabled&&(t.enabled=!1,e==="roll"&&t.original&&this.parent.appendChild(t.original),e==="vcr"&&clearInterval(this.vcrInterval),e==="snow"&&cancelAnimationFrame(this.snowframe),t.node?t.wrapper.removeChild(t.node):t.wrapper.classList.remove(e)),this}enableRoll(){const e=this.parent.firstElementChild;if(e){const t=document.createElement("div");t.classList.add("roller"),this.parent.appendChild(t),t.appendChild(e),t.appendChild(e.cloneNode(!0)),this.effects.roll={enabled:!0,wrapper:this.parent,node:t,original:e}}}generateVCRNoise(){this.effects.vcr.node;const e=this.effects.vcr.config;if(this.effects.vcr.node,e.fps>=60){cancelAnimationFrame(this.vcrInterval);const t=()=>{this.renderTrackingNoise(),this.vcrInterval=requestAnimationFrame(t)};t()}else clearInterval(this.vcrInterval),this.vcrInterval=setInterval(()=>{this.renderTrackingNoise()},1e3/e.fps)}generateSnow(e){for(var t=e.canvas.width,a=e.canvas.height,s=e.createImageData(t,a),n=new Uint32Array(s.data.buffer),r=n.length,o=0;o<r;o++)n[o]=(255*Math.random()|0)<<24;e.putImageData(s,0,0)}renderTrackingNoise(e=2,t,a){const s=this.effects.vcr.node,n=this.effects.vcr.ctx,r=this.effects.vcr.config;let o=r.miny||0,i=r.maxy||s.height,l=r.miny2||0;const h=r.num||20;t===void 0&&(t=s.width),a===void 0&&(a=s.height),s.style.filter=`blur(${r.blur}px)`,n.clearRect(0,0,s.width,s.height),n.fillStyle="#fff",n.beginPath();for(var f=0;f<=h;f++){var d=Math.random(f)*t,m=p(o+=3,i),g=p(0,l-=3);n.fillRect(d,m,e,e),n.fillRect(d,g,e,e),n.fill(),this.renderTail(n,d,m,e),this.renderTail(n,d,g,e)}n.closePath()}renderTail(e,t,a,s){const n=p(1,50),r=[1,-1];let o=s;const i=r[Math.floor(Math.random()*r.length)];for(let l=0;l<n;l++){let f=p(o-=.01,s),d=p(1,4);s-=.1,d*=i,e.fillRect(t+=d,a,f,f),e.fill()}}}const w=new u("#screen",{}),v={effects:{vignette:{enabled:!0},vcr:{enabled:!1,options:{opacity:1,miny:220,miny2:220,num:70,fps:60}},snow:{enabled:!0,options:{opacity:.1}}}};setTimeout(()=>{for(const c in v.effects)v.effects[c].enabled&&w.add(c,v.effects[c].options)},5);
